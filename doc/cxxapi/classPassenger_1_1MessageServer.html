<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Passenger: Passenger::MessageServer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacePassenger.html">Passenger</a>::<a class="el" href="classPassenger_1_1MessageServer.html">MessageServer</a>
  </div>
</div>
<div class="contents">
<h1>Passenger::MessageServer Class Reference<br/>
<small>
[<a class="el" href="group__Support.html">Apache-independent support classes and function</a>]</small>
</h1><!-- doxytag: class="Passenger::MessageServer" -->
<p>Simple pluggable request/response messaging server framework.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="MessageServer_8h_source.html">MessageServer.h</a>&gt;</code></p>

<p><a href="classPassenger_1_1MessageServer-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer_1_1ClientContext.html">ClientContext</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Interface for client context objects.  <a href="classPassenger_1_1MessageServer_1_1ClientContext.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer_1_1CommonClientContext.html">CommonClientContext</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A common client context, containing client-specific information used by <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> itself.  <a href="classPassenger_1_1MessageServer_1_1CommonClientContext.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structPassenger_1_1MessageServer_1_1DisconnectEventBroadcastGuard.html">DisconnectEventBroadcastGuard</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calls clientDisconnected() on all handlers when destroyed.  <a href="structPassenger_1_1MessageServer_1_1DisconnectEventBroadcastGuard.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer_1_1Handler.html">Handler</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An abstract message handler class.  <a href="classPassenger_1_1MessageServer_1_1Handler.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#a4b6f33e66261116c2ec04b26e651dc18">MessageServer</a> (const string &amp;<a class="el" href="classPassenger_1_1MessageServer.html#a18f4966401ab1f1ef245af922b382ce3">socketFilename</a>, AccountsDatabasePtr <a class="el" href="classPassenger_1_1MessageServer.html#a4705130bf6626dd2201e7d73ead57b93">accountsDatabase</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Creates a new <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> object.  <a href="#a4b6f33e66261116c2ec04b26e651dc18"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#aaf639d8228da241b957c707ef0f04c91">mainLoop</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Starts the server main loop.  <a href="#aaf639d8228da241b957c707ef0f04c91"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#a8f5df648df67f85ab0b7317be21f643f">addHandler</a> (HandlerPtr handler)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Registers a new handler.  <a href="#a8f5df648df67f85ab0b7317be21f643f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#a91571b29a8a88f80bab68f8083f59291">setLoginTimeout</a> (unsigned long long timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets the maximum number of milliseconds that clients may spend on logging in.  <a href="#a91571b29a8a88f80bab68f8083f59291"></a><br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#a86f9ec99fe5dbed5c04d4b9e8f170995">startListening</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a server socket and set it up for listening.  <a href="#a86f9ec99fe5dbed5c04d4b9e8f170995"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AccountPtr&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#a6687fdc90ef1c361a69c0fdcde38bb42">authenticate</a> (<a class="el" href="classPassenger_1_1FileDescriptor.html">FileDescriptor</a> &amp;client)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Authenticate the given client and returns its account information.  <a href="#a6687fdc90ef1c361a69c0fdcde38bb42"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac7d708f90b3a1b1ae5e7b215c688c95e"></a><!-- doxytag: member="Passenger::MessageServer::clientHandlingMainLoop" ref="ac7d708f90b3a1b1ae5e7b215c688c95e" args="(FileDescriptor &amp;client)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#ac7d708f90b3a1b1ae5e7b215c688c95e">clientHandlingMainLoop</a> (<a class="el" href="classPassenger_1_1FileDescriptor.html">FileDescriptor</a> &amp;client)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The main function for a thread which handles a client. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#a18f4966401ab1f1ef245af922b382ce3">socketFilename</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The filename of the server socket on which this <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> is listening.  <a href="#a18f4966401ab1f1ef245af922b382ce3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AccountsDatabasePtr&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#a4705130bf6626dd2201e7d73ead57b93">accountsDatabase</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An accounts database, used for authenticating clients.  <a href="#a4705130bf6626dd2201e7d73ead57b93"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">vector&lt; HandlerPtr &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#abced7a8e542f6ab4a81ac1b11f8d163a">handlers</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The registered message handlers.  <a href="#abced7a8e542f6ab4a81ac1b11f8d163a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned long long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#abf5075add15c5f32a60039bdcbe98926">loginTimeout</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The maximum number of milliseconds that client may spend on logging in.  <a href="#abf5075add15c5f32a60039bdcbe98926"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">dynamic_thread_group&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#a48ccf2c09c2c8b5dcfe3a0585dba67cf">threadGroup</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The client threads.  <a href="#a48ccf2c09c2c8b5dcfe3a0585dba67cf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPassenger_1_1MessageServer.html#aef3c642484fbbbfc46b7768c53a5c0d4">serverFd</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The server socket's file descriptor.  <a href="#aef3c642484fbbbfc46b7768c53a5c0d4"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Simple pluggable request/response messaging server framework. </p>
<p><a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> implements a server with the following properties:</p>
<ul>
<li>It listens on a Unix socket. Socket creation and destruction is automatically handled. The socket is world-writable because a username/password authentication scheme is used to enforce security.</li>
<li>Multithreaded: 1 thread per client.</li>
<li>Designed for simple request/response cycles. That is, a client sends a request, and the server may respond with arbitrary data. The server does not respond sporadically, i.e. it only responds after a request.</li>
<li>Requests are discrete <a class="el" href="classPassenger_1_1MessageChannel.html" title="Convenience class for I/O operations on file descriptors.">MessageChannel</a> array messages, not byte streams.</li>
<li>Connections are authenticated. Connecting clients must send a username and password, which are then checked against an accounts database. The associated account is known throughout the entire connection life time so that it's possible to implement authorization features.</li>
</ul>
<p><a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> does not process messages by itself. Instead, one registers handlers which handle message processing. This framework allows one to seperate message handling code by function, while allowing everything to listen on the same socket and to use a common request parsing and dispatching codebase.</p>
<p>A username/password authentication scheme was chosen over a file permission scheme because experience has shown that the latter is inadequate. For example, the web server may consist of multiple worker processes, each running as a different user. Although ACLs can solve this problem as well, not every platform supports ACLs by default.</p>
<h2>Writing handlers</h2>
<p>Handlers must inherit from <a class="el" href="classPassenger_1_1MessageServer_1_1Handler.html" title="An abstract message handler class.">MessageServer::Handler</a>. They may implement newClient() and must implement processMessage().</p>
<p>When a new client is accepted, <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> will call newClient() on all handlers. This method accepts one argument: a common client context object. This context object contains client-specific information, such as its file descriptor. It cannot be extended to store more information, but it is passed to every handler anyway, hence the word "common" in its name. newClient() is supposed to return a handler-specific client context object for storing its own information, or a null pointer if it doesn't need to store anything.</p>
<p>When a client sends a request, <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> iterates through all handlers and calls processMessage() on each one, passing it the common client context and the handler-specific client context. processMessage() may return either true or false; true indicates that the handler processed the message, false indicates that it did not. Iteration stops at the first handler that returns true. If all handlers return false, i.e. the client sent a message that no handler recognizes, then <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> will close the connection with the client.</p>
<p>Handlers do not need to be thread-safe as long as they only operate on data in the context objects. <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> ensures that context objects are not shared with other threads.</p>
<h2>Usage example</h2>
<p>This implements a simple ping server. Every time a "ping" request is sent, the server responds with "pong" along with the number of times it had already sent pong to the same client in the past.</p>
<div class="fragment"><pre class="fragment">   <span class="keyword">class </span>PingHandler: <span class="keyword">public</span> <a class="code" href="classPassenger_1_1MessageServer.html#a4b6f33e66261116c2ec04b26e651dc18" title="Creates a new MessageServer object.">MessageServer</a>::Handler {
   <span class="keyword">public</span>:
       <span class="keyword">struct </span>MyContext: <span class="keyword">public</span> <a class="code" href="classPassenger_1_1MessageServer.html#a4b6f33e66261116c2ec04b26e651dc18" title="Creates a new MessageServer object.">MessageServer</a>::ClientContext {
           <span class="keywordtype">int</span> count;
           
           MyContext() {
               count = 0;
           }
       };
       
       MessageServer::ClientContextPtr newClient(MessageServer::CommonClientContext &amp;commonContext) {
           <span class="keywordflow">return</span> MessageServer::ClientContextPtr(<span class="keyword">new</span> MyContext());
       }
       
       <span class="keywordtype">bool</span> processMessage(MessageServer::CommonClientContext &amp;commonContext,
                           MessageServer::ClientContextPtr &amp;specificContext,
                           <span class="keyword">const</span> vector&lt;string&gt; &amp;args)
       {
           <span class="keywordflow">if</span> (args[0] == <span class="stringliteral">&quot;ping&quot;</span>) {
               MyContext *myContext = (MyContext *) specificContext.get();
               commonContext.channel.write(<span class="stringliteral">&quot;pong&quot;</span>, toString(specificContext-&gt;count).c_str(), NULL);
               specificContext-&gt;count++;
               <span class="keywordflow">return</span> <span class="keyword">true</span>;
           } <span class="keywordflow">else</span> {
               <span class="keywordflow">return</span> <span class="keyword">false</span>;
           }
       }
   };
   
   ...
   
   <a class="code" href="classPassenger_1_1MessageServer.html#a4b6f33e66261116c2ec04b26e651dc18" title="Creates a new MessageServer object.">MessageServer</a> server(<span class="stringliteral">&quot;server.sock&quot;</span>);
   server.addHandler(MessageServer::HandlerPtr(<span class="keyword">new</span> PingHandler()));
   server.addHandler(MessageServer::HandlerPtr(<span class="keyword">new</span> PingHandler()));
   server.mainLoop();
</pre></div> <hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4b6f33e66261116c2ec04b26e651dc18"></a><!-- doxytag: member="Passenger::MessageServer::MessageServer" ref="a4b6f33e66261116c2ec04b26e651dc18" args="(const string &amp;socketFilename, AccountsDatabasePtr accountsDatabase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Passenger::MessageServer::MessageServer </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&nbsp;</td>
          <td class="paramname"> <em>socketFilename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AccountsDatabasePtr&nbsp;</td>
          <td class="paramname"> <em>accountsDatabase</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Creates a new <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> object. </p>
<p>The actual server main loop is not started until you call <a class="el" href="classPassenger_1_1MessageServer.html#aaf639d8228da241b957c707ef0f04c91" title="Starts the server main loop.">mainLoop()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>socketFilename</em>&nbsp;</td><td>The socket filename on which this <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> should be listening. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>accountsDatabase</em>&nbsp;</td><td>An accounts database for this server, used for authenticating clients. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classPassenger_1_1RuntimeException.html" title="A generic runtime exception.">RuntimeException</a></em>&nbsp;</td><td>Something went wrong while setting up the server socket. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classPassenger_1_1SystemException.html" title="Represents an error returned by a system call or a standard library call.">SystemException</a></em>&nbsp;</td><td>Something went wrong while setting up the server socket. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>boost::thread_interrupted</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a8f5df648df67f85ab0b7317be21f643f"></a><!-- doxytag: member="Passenger::MessageServer::addHandler" ref="a8f5df648df67f85ab0b7317be21f643f" args="(HandlerPtr handler)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Passenger::MessageServer::addHandler </td>
          <td>(</td>
          <td class="paramtype">HandlerPtr&nbsp;</td>
          <td class="paramname"> <em>handler</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Registers a new handler. </p>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>The main loop isn't running. </dd></dl>

</div>
</div>
<a class="anchor" id="a6687fdc90ef1c361a69c0fdcde38bb42"></a><!-- doxytag: member="Passenger::MessageServer::authenticate" ref="a6687fdc90ef1c361a69c0fdcde38bb42" args="(FileDescriptor &amp;client)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AccountPtr Passenger::MessageServer::authenticate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPassenger_1_1FileDescriptor.html">FileDescriptor</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>client</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Authenticate the given client and returns its account information. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>A smart pointer to an Account object, or NULL if authentication failed. </dd></dl>

</div>
</div>
<a class="anchor" id="aaf639d8228da241b957c707ef0f04c91"></a><!-- doxytag: member="Passenger::MessageServer::mainLoop" ref="aaf639d8228da241b957c707ef0f04c91" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Passenger::MessageServer::mainLoop </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts the server main loop. </p>
<p>This method will loop forever until some other thread interrupts the calling thread, or until an exception is raised.</p>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classPassenger_1_1SystemException.html" title="Represents an error returned by a system call or a standard library call.">SystemException</a></em>&nbsp;</td><td>Unable to accept a new connection. If this is a non-fatal error then you may call <a class="el" href="classPassenger_1_1MessageServer.html#aaf639d8228da241b957c707ef0f04c91" title="Starts the server main loop.">mainLoop()</a> again to restart the server main loop. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>boost::thread_interrupted</em>&nbsp;</td><td>The calling thread has been interrupted. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a91571b29a8a88f80bab68f8083f59291"></a><!-- doxytag: member="Passenger::MessageServer::setLoginTimeout" ref="a91571b29a8a88f80bab68f8083f59291" args="(unsigned long long timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Passenger::MessageServer::setLoginTimeout </td>
          <td>(</td>
          <td class="paramtype">unsigned long long&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets the maximum number of milliseconds that clients may spend on logging in. </p>
<p>Clients that take longer are disconnected.</p>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>timeout != 0 </dd>
<dd>
The main loop isn't running. </dd></dl>

</div>
</div>
<a class="anchor" id="a86f9ec99fe5dbed5c04d4b9e8f170995"></a><!-- doxytag: member="Passenger::MessageServer::startListening" ref="a86f9ec99fe5dbed5c04d4b9e8f170995" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Passenger::MessageServer::startListening </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a server socket and set it up for listening. </p>
<p>This socket will be world-writable.</p>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classPassenger_1_1RuntimeException.html" title="A generic runtime exception.">RuntimeException</a></em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classPassenger_1_1SystemException.html" title="Represents an error returned by a system call or a standard library call.">SystemException</a></em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>boost::thread_interrupted</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a4705130bf6626dd2201e7d73ead57b93"></a><!-- doxytag: member="Passenger::MessageServer::accountsDatabase" ref="a4705130bf6626dd2201e7d73ead57b93" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AccountsDatabasePtr <a class="el" href="classPassenger_1_1MessageServer.html#a4705130bf6626dd2201e7d73ead57b93">Passenger::MessageServer::accountsDatabase</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>An accounts database, used for authenticating clients. </p>

</div>
</div>
<a class="anchor" id="abced7a8e542f6ab4a81ac1b11f8d163a"></a><!-- doxytag: member="Passenger::MessageServer::handlers" ref="abced7a8e542f6ab4a81ac1b11f8d163a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;HandlerPtr&gt; <a class="el" href="classPassenger_1_1MessageServer.html#abced7a8e542f6ab4a81ac1b11f8d163a">Passenger::MessageServer::handlers</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The registered message handlers. </p>

</div>
</div>
<a class="anchor" id="abf5075add15c5f32a60039bdcbe98926"></a><!-- doxytag: member="Passenger::MessageServer::loginTimeout" ref="abf5075add15c5f32a60039bdcbe98926" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long long <a class="el" href="classPassenger_1_1MessageServer.html#abf5075add15c5f32a60039bdcbe98926">Passenger::MessageServer::loginTimeout</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The maximum number of milliseconds that client may spend on logging in. </p>
<p>Clients that take longer are disconnected.</p>
<dl class="invariant"><dt><b>Invariant:</b></dt><dd>loginTimeout != 0 </dd></dl>

</div>
</div>
<a class="anchor" id="aef3c642484fbbbfc46b7768c53a5c0d4"></a><!-- doxytag: member="Passenger::MessageServer::serverFd" ref="aef3c642484fbbbfc46b7768c53a5c0d4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classPassenger_1_1MessageServer.html#aef3c642484fbbbfc46b7768c53a5c0d4">Passenger::MessageServer::serverFd</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The server socket's file descriptor. </p>
<dl class="invariant"><dt><b>Invariant:</b></dt><dd>serverFd &gt;= 0 </dd></dl>

</div>
</div>
<a class="anchor" id="a18f4966401ab1f1ef245af922b382ce3"></a><!-- doxytag: member="Passenger::MessageServer::socketFilename" ref="a18f4966401ab1f1ef245af922b382ce3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string <a class="el" href="classPassenger_1_1MessageServer.html#a18f4966401ab1f1ef245af922b382ce3">Passenger::MessageServer::socketFilename</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The filename of the server socket on which this <a class="el" href="classPassenger_1_1MessageServer.html" title="Simple pluggable request/response messaging server framework.">MessageServer</a> is listening. </p>

</div>
</div>
<a class="anchor" id="a48ccf2c09c2c8b5dcfe3a0585dba67cf"></a><!-- doxytag: member="Passenger::MessageServer::threadGroup" ref="a48ccf2c09c2c8b5dcfe3a0585dba67cf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">dynamic_thread_group <a class="el" href="classPassenger_1_1MessageServer.html#a48ccf2c09c2c8b5dcfe3a0585dba67cf">Passenger::MessageServer::threadGroup</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The client threads. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="MessageServer_8h_source.html">MessageServer.h</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
